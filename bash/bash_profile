#-------------------------------------------------------------
# .bash_profile is only run on login, whereas .bashrc is
# run for each terminal
#-------------------------------------------------------------

#-------------------------------------------------------------
# pseudo-code for how bash scripts are executed
#-------------------------------------------------------------

# execute /etc/profile
# IF ~/.bash_profile exists THEN
#     execute ~/.bash_profile
# ELSE
#     IF ~/.bash_login exist THEN
#         execute ~/.bash_login
#     ELSE
#         IF ~/.profile exist THEN
#             execute ~/.profile
#         END IF
#     END IF
# END IF

# IF ~/.bash_logout exists THEN
#     execute ~/.bash_logout
# END IF

#-------------------------------------------------------------
# General setup
#-------------------------------------------------------------

if [ -f ~/.bashrc ]; then
  . ~/.bashrc
fi

# override /usr/bin with /usr/local/bin
export PATH="~/.cabal/bin:/usr/local/bin:/usr/local/sbin:~/Scripts:~/Scripts/local:$PATH"

#-------------------------------------------------------------
# Default editor
#-------------------------------------------------------------

export VISUAL=vim
export EDITOR="$VISUAL"

# turn on vi mode for bash
set -o vi

#-------------------------------------------------------------
# Git customizations
#-------------------------------------------------------------

export GIT_EDITOR="$VISUAL"

# Put Git branch name in shell prompt
parse_git_branch() {
    git branch 2> /dev/null | sed -e '/^[^*]/d' -e 's/* \(.*\)/(\1)/'
}
gitbranch="\$(parse_git_branch)"
PS1="${debian_chroot:+($debian_chroot)}\[\033[01;32m\]\u@\h\[\033[00m\]:\[\033[01;34m\]\w\[\033[00m\] $gitbranch\$ "
export CLICOLOR=1
export LSCOLORS=gxfxaxdxcxegedabagacad

# enable git autocomplete
source ~/Scripts/git-completion.sh

# load any custom scripts
if [ "$(ls ~/Scripts/bash_profile_includes)" ]; then
  source ~/Scripts/bash_profile_includes/*
fi

# git tree shortcut

alias gt='git log --graph --pretty=oneline --all --abbrev-commit'

#-------------------------------------------------------------
# Java
#-------------------------------------------------------------

export ATLAS_OPTS="-Xms768m -Xmx6144m -XX:MaxPermSize=128M"
export MAVEN_OPTS="-Xms768m -Xmx6144m -XX:MaxPermSize=128M"

#-------------------------------------------------------------
# Go
#-------------------------------------------------------------

export GOPATH=$HOME/go
export PATH=$PATH:$GOPATH/bin
ulimit -n 8096

#-------------------------------------------------------------
# Homebrew
#-------------------------------------------------------------

export HOMEBREW_NO_ANALYTICS=1
HOMEBREW_API_TOKEN_FILE=~/Scripts/config/homebrew_github_api_token
if [ -e "$HOMEBREW_API_TOKEN_FILE" ]; then
  export HOMEBREW_GITHUB_API_TOKEN=$(cat ${HOMEBREW_API_TOKEN_FILE})
fi

#-------------------------------------------------------------
# Platform specific
#-------------------------------------------------------------
if [ "$(uname)" == "Darwin" ]; then
  export PATH="$PATH:~/Library/Android/sdk/platform-tools"
  export JAVA_HOME=$(/usr/libexec/java_home)
  export ANDROID_SDK="/Applications/Android Studio.app/sdk"
  export ANDROID_HOME="/Applications/Android Studio.app/sdk"

  # Bash completion
  if [ -f $(brew --prefix)/etc/bash_completion ]; then
    . $(brew --prefix)/etc/bash_completion
  fi

  #-------------------------------------------------------------
  # Google Cloud SDK
  #-------------------------------------------------------------

  source '/usr/local/Caskroom/google-cloud-sdk/latest/google-cloud-sdk/path.bash.inc'
  source '/usr/local/Caskroom/google-cloud-sdk/latest/google-cloud-sdk/completion.bash.inc'
elif [ "$(expr substr $(uname -s) 1 5)" == "Linux" ]; then
  if [ ! -z $DISPLAY ]; then
    # keyboard rate
    xset r rate 250 30
  fi

  # Vim FZF config
  export FZF_DEFAULT_COMMAND='rg --files --no-ignore --no-messages --hidden --follow --glob "!.git/*"'
  # export FZF_DEFAULT_COMMAND='ag --nocolor -g ""'
  export FZF_CTRL_T_COMMAND="$FZF_DEFAULT_COMMAND"
  export FZF_ALT_C_COMMAND="$FZF_DEFAULT_COMMAND"
  export FZF_DEFAULT_OPTS='
  --color fg:242,bg:236,hl:65,fg+:15,bg+:239,hl+:108
  --color info:108,prompt:109,spinner:108,pointer:168,marker:168
  '
fi
